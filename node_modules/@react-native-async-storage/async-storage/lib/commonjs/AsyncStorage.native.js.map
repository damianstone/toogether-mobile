{"version":3,"sources":["AsyncStorage.native.js"],"names":["RCTAsyncStorage","Error","checkValidInput","usedKey","value","isValuePassed","arguments","length","console","warn","checkValidArgs","keyValuePairs","callback","Array","isArray","AsyncStorage","_getRequests","_getKeys","_immediate","getItem","key","Promise","resolve","reject","multiGet","errors","result","errs","convertErrors","setItem","multiSet","removeItem","multiRemove","mergeItem","multiMerge","clear","error","err","convertError","getAllKeys","keys","flushGetRequests","getRequests","getKeys","map","forEach","reqLength","errorList","i","request","requestResult","setImmediate","getRequest","keyIndex","promiseResult","push","indexOf","e","out","message"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n * @jsdoc\n */\n\n'use strict';\n\nimport RCTAsyncStorage from './RCTAsyncStorage';\n\nif (!RCTAsyncStorage) {\n  throw new Error(`[@RNC/AsyncStorage]: NativeModule: AsyncStorage is null.\n\nTo fix this issue try these steps:\n\n  • Run \\`react-native link @react-native-async-storage/async-storage\\` in the project root.\n\n  • Rebuild and restart the app.\n\n  • Run the packager with \\`--reset-cache\\` flag.\n\n  • If you are using CocoaPods on iOS, run \\`pod install\\` in the \\`ios\\` directory and then rebuild and re-run the app.\n\n  • If this happens while testing with Jest, check out docs how to integrate AsyncStorage with it: https://react-native-async-storage.github.io/async-storage/docs/advanced/jest\n\nIf none of these fix the issue, please open an issue on the Github repository: https://github.com/react-native-async-storage/react-native-async-storage/issues\n`);\n}\n\ntype ReadOnlyArrayString = $ReadOnlyArray<string>;\n\ntype MultiGetCallbackFunction = (\n  errors: ?$ReadOnlyArray<Error>,\n  result: ?$ReadOnlyArray<ReadOnlyArrayString>,\n) => void;\n\ntype MultiRequest = {|\n  keys: $ReadOnlyArray<string>,\n  callback: ?MultiGetCallbackFunction,\n  keyIndex: number,\n  resolve: ?(result?: Promise<?$ReadOnlyArray<ReadOnlyArrayString>>) => void,\n  reject: ?(error?: any) => void,\n|};\n\nfunction checkValidInput(usedKey: string, value: any) {\n  const isValuePassed = arguments.length > 1;\n\n  if (typeof usedKey !== 'string') {\n    console.warn(\n      `[AsyncStorage] Using ${typeof usedKey} type for key is not supported. This can lead to unexpected behavior/errors. Use string instead.\\nKey passed: ${usedKey}\\n`,\n    );\n  }\n\n  if (isValuePassed && typeof value !== 'string') {\n    if (value == null) {\n      throw new Error(\n        `[AsyncStorage] Passing null/undefined as value is not supported. If you want to remove value, Use .removeItem method instead.\\nPassed value: ${value}\\nPassed key: ${usedKey}\\n`,\n      );\n    } else {\n      console.warn(\n        `[AsyncStorage] The value for key \"${usedKey}\" is not a string. This can lead to unexpected behavior/errors. Consider stringifying it.\\nPassed value: ${value}\\nPassed key: ${usedKey}\\n`,\n      );\n    }\n  }\n}\n\nfunction checkValidArgs(keyValuePairs, callback) {\n  if (\n    !Array.isArray(keyValuePairs) ||\n    keyValuePairs.length === 0 ||\n    !Array.isArray(keyValuePairs[0])\n  ) {\n    throw new Error(\n      '[AsyncStorage] Expected array of key-value pairs as first argument to multiSet',\n    );\n  }\n\n  if (callback && typeof callback !== 'function') {\n    if (Array.isArray(callback)) {\n      throw new Error(\n        '[AsyncStorage] Expected function as second argument to multiSet. Did you forget to wrap key-value pairs in an array for the first argument?',\n      );\n    }\n\n    throw new Error(\n      '[AsyncStorage] Expected function as second argument to multiSet',\n    );\n  }\n}\n\n/**\n * `AsyncStorage` is a simple, unencrypted, asynchronous, persistent, key-value\n * storage system that is global to the app.  It should be used instead of\n * LocalStorage.\n *\n * See http://reactnative.dev/docs/asyncstorage.html\n */\nconst AsyncStorage = {\n  _getRequests: ([]: Array<MultiRequest>),\n  _getKeys: ([]: Array<string>),\n  _immediate: (null: ?number),\n\n  /**\n   * Fetches an item for a `key` and invokes a callback upon completion.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#getitem\n   */\n  getItem: function (\n    key: string,\n    callback?: ?(error: ?Error, result: string | null) => void,\n  ): Promise<string | null> {\n    return new Promise((resolve, reject) => {\n      checkValidInput(key);\n      RCTAsyncStorage.multiGet([key], function (errors, result) {\n        // Unpack result to get value from [[key,value]]\n        const value = result && result[0] && result[0][1] ? result[0][1] : null;\n        const errs = convertErrors(errors);\n        callback && callback(errs && errs[0], value);\n        if (errs) {\n          reject(errs[0]);\n        } else {\n          resolve(value);\n        }\n      });\n    });\n  },\n\n  /**\n   * Sets the value for a `key` and invokes a callback upon completion.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#setitem\n   */\n  setItem: function (\n    key: string,\n    value: string,\n    callback?: ?(error: ?Error) => void,\n  ): Promise<null> {\n    return new Promise((resolve, reject) => {\n      checkValidInput(key, value);\n      RCTAsyncStorage.multiSet([[key, value]], function (errors) {\n        const errs = convertErrors(errors);\n        callback && callback(errs && errs[0]);\n        if (errs) {\n          reject(errs[0]);\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  },\n\n  /**\n   * Removes an item for a `key` and invokes a callback upon completion.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#removeitem\n   */\n  removeItem: function (\n    key: string,\n    callback?: ?(error: ?Error) => void,\n  ): Promise<null> {\n    return new Promise((resolve, reject) => {\n      checkValidInput(key);\n      RCTAsyncStorage.multiRemove([key], function (errors) {\n        const errs = convertErrors(errors);\n        callback && callback(errs && errs[0]);\n        if (errs) {\n          reject(errs[0]);\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  },\n\n  /**\n   * Merges an existing `key` value with an input value, assuming both values\n   * are stringified JSON.\n   *\n   * **NOTE:** This is not supported by all native implementations.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#mergeitem\n   */\n  mergeItem: function (\n    key: string,\n    value: string,\n    callback?: ?(error: ?Error) => void,\n  ): Promise<null> {\n    return new Promise((resolve, reject) => {\n      checkValidInput(key, value);\n      RCTAsyncStorage.multiMerge([[key, value]], function (errors) {\n        const errs = convertErrors(errors);\n        callback && callback(errs && errs[0]);\n        if (errs) {\n          reject(errs[0]);\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  },\n\n  /**\n   * Erases *all* `AsyncStorage` for all clients, libraries, etc. You probably\n   * don't want to call this; use `removeItem` or `multiRemove` to clear only\n   * your app's keys.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#clear\n   */\n  clear: function (callback?: ?(error: ?Error) => void): Promise<null> {\n    return new Promise((resolve, reject) => {\n      RCTAsyncStorage.clear(function (error) {\n        const err = convertError(error);\n        callback && callback(err);\n        if (err) {\n          reject(err);\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  },\n\n  /**\n   * Gets *all* keys known to your app; for all callers, libraries, etc.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#getallkeys\n   */\n  getAllKeys: function (\n    callback?: ?(error: ?Error, keys: ?ReadOnlyArrayString) => void,\n  ): Promise<ReadOnlyArrayString> {\n    return new Promise((resolve, reject) => {\n      RCTAsyncStorage.getAllKeys(function (error, keys) {\n        const err = convertError(error);\n        callback && callback(err, keys);\n        if (err) {\n          reject(err);\n        } else {\n          resolve(keys);\n        }\n      });\n    });\n  },\n\n  /**\n   * The following batched functions are useful for executing a lot of\n   * operations at once, allowing for native optimizations and provide the\n   * convenience of a single callback after all operations are complete.\n   *\n   * These functions return arrays of errors, potentially one for every key.\n   * For key-specific errors, the Error object will have a key property to\n   * indicate which key caused the error.\n   */\n\n  /**\n   * Flushes any pending requests using a single batch call to get the data.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#flushgetrequests\n   * */\n  flushGetRequests: function (): void {\n    const getRequests = this._getRequests;\n    const getKeys = this._getKeys;\n\n    this._getRequests = [];\n    this._getKeys = [];\n\n    RCTAsyncStorage.multiGet(getKeys, function (errors, result) {\n      // Even though the runtime complexity of this is theoretically worse vs if we used a map,\n      // it's much, much faster in practice for the data sets we deal with (we avoid\n      // allocating result pair arrays). This was heavily benchmarked.\n      //\n      // Is there a way to avoid using the map but fix the bug in this breaking test?\n      // https://github.com/facebook/react-native/commit/8dd8ad76579d7feef34c014d387bf02065692264\n      const map = {};\n      result &&\n        result.forEach(([key, value]) => {\n          map[key] = value;\n          return value;\n        });\n      const reqLength = getRequests.length;\n\n      /**\n       * As mentioned few lines above, this method could be called with the array of potential error,\n       * in case of anything goes wrong. The problem is, if any of the batched calls fails\n       * the rest of them would fail too, but the error would be consumed by just one. The rest\n       * would simply return `undefined` as their result, rendering false negatives.\n       *\n       * In order to avoid this situation, in case of any call failing,\n       * the rest of them will be rejected as well (with the same error).\n       */\n      const errorList = convertErrors(errors);\n      const error = errorList && errorList.length ? errorList[0] : null;\n\n      for (let i = 0; i < reqLength; i++) {\n        const request = getRequests[i];\n        if (error) {\n          request.callback && request.callback(error);\n          request.reject && request.reject(error);\n          continue;\n        }\n        const requestResult = request.keys.map((key) => [key, map[key]]);\n        request.callback && request.callback(null, requestResult);\n        request.resolve && request.resolve(requestResult);\n      }\n    });\n  },\n\n  /**\n   * This allows you to batch the fetching of items given an array of `key`\n   * inputs. Your callback will be invoked with an array of corresponding\n   * key-value pairs found.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#multiget\n   */\n  multiGet: function (\n    keys: Array<string>,\n    callback?: ?MultiGetCallbackFunction,\n  ): Promise<?$ReadOnlyArray<ReadOnlyArrayString>> {\n    if (!this._immediate) {\n      this._immediate = setImmediate(() => {\n        this._immediate = null;\n        this.flushGetRequests();\n      });\n    }\n\n    const getRequest: MultiRequest = {\n      keys: keys,\n      callback: callback,\n      // do we need this?\n      keyIndex: this._getKeys.length,\n      resolve: null,\n      reject: null,\n    };\n\n    const promiseResult = new Promise((resolve, reject) => {\n      getRequest.resolve = resolve;\n      getRequest.reject = reject;\n    });\n\n    this._getRequests.push(getRequest);\n    // avoid fetching duplicates\n    keys.forEach((key) => {\n      if (this._getKeys.indexOf(key) === -1) {\n        this._getKeys.push(key);\n      }\n    });\n\n    return promiseResult;\n  },\n\n  /**\n   * Use this as a batch operation for storing multiple key-value pairs. When\n   * the operation completes you'll get a single callback with any errors.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#multiset\n   */\n  multiSet: function (\n    keyValuePairs: Array<Array<string>>,\n    callback?: ?(errors: ?$ReadOnlyArray<?Error>) => void,\n  ): Promise<null> {\n    checkValidArgs(keyValuePairs, callback);\n    return new Promise((resolve, reject) => {\n      keyValuePairs.forEach(([key, value]) => {\n        checkValidInput(key, value);\n      });\n\n      RCTAsyncStorage.multiSet(keyValuePairs, function (errors) {\n        const error = convertErrors(errors);\n        callback && callback(error);\n        if (error) {\n          reject(error);\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  },\n\n  /**\n   * Call this to batch the deletion of all keys in the `keys` array.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#multiremove\n   */\n  multiRemove: function (\n    keys: Array<string>,\n    callback?: ?(errors: ?$ReadOnlyArray<?Error>) => void,\n  ): Promise<null> {\n    return new Promise((resolve, reject) => {\n      keys.forEach((key) => checkValidInput(key));\n\n      RCTAsyncStorage.multiRemove(keys, function (errors) {\n        const error = convertErrors(errors);\n        callback && callback(error);\n        if (error) {\n          reject(error);\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  },\n\n  /**\n   * Batch operation to merge in existing and new values for a given set of\n   * keys. This assumes that the values are stringified JSON.\n   *\n   * **NOTE**: This is not supported by all native implementations.\n   *\n   * See http://reactnative.dev/docs/asyncstorage.html#multimerge\n   */\n  multiMerge: function (\n    keyValuePairs: Array<Array<string>>,\n    callback?: ?(errors: ?$ReadOnlyArray<?Error>) => void,\n  ): Promise<null> {\n    return new Promise((resolve, reject) => {\n      RCTAsyncStorage.multiMerge(keyValuePairs, function (errors) {\n        const error = convertErrors(errors);\n        callback && callback(error);\n        if (error) {\n          reject(error);\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  },\n};\n\n// Not all native implementations support merge.\nif (!RCTAsyncStorage.multiMerge) {\n  // $FlowFixMe\n  delete AsyncStorage.mergeItem;\n  // $FlowFixMe\n  delete AsyncStorage.multiMerge;\n}\n\nfunction convertErrors(errs): ?$ReadOnlyArray<?Error> {\n  if (!errs || (Array.isArray(errs) && errs.length === 0)) {\n    return null;\n  }\n  return (Array.isArray(errs) ? errs : [errs]).map((e) => convertError(e));\n}\n\nfunction convertError(error): ?Error {\n  if (!error) {\n    return null;\n  }\n  const out = new Error(error.message);\n  // $FlowFixMe: adding custom properties to error.\n  out.key = error.key;\n  return out;\n}\n\nexport default AsyncStorage;\n"]}