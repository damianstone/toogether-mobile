{"version":3,"file":"getPrebuildConfig.js","names":["getPrebuildConfigAsync","projectRoot","props","autolinkedModules","getAutolinkedPackagesAsync","platforms","getPrebuildConfig","bundleIdentifier","packageName","expoUsername","exp","config","rest","getConfig","skipSDKVersionRequirement","isModdedConfig","_internal","resolvedExpoUsername","getAccountUsername","withVersionedExpoSDKPlugins","withLegacyExpoPlugins","includes","ios","withIosExpoPlugins","android","package","withAndroidExpoPlugins"],"sources":["../src/getPrebuildConfig.ts"],"sourcesContent":["import { getAccountUsername, getConfig } from '@expo/config';\nimport { ModPlatform } from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\n\nimport { getAutolinkedPackagesAsync } from './getAutolinkedPackages';\nimport {\n  withAndroidExpoPlugins,\n  withIosExpoPlugins,\n  withLegacyExpoPlugins,\n  withVersionedExpoSDKPlugins,\n} from './plugins/withDefaultPlugins';\n\nexport async function getPrebuildConfigAsync(\n  projectRoot: string,\n  props: {\n    bundleIdentifier?: string;\n    packageName?: string;\n    platforms: ModPlatform[];\n    expoUsername?: string | ((config: ExpoConfig) => string | null);\n  }\n): Promise<ReturnType<typeof getConfig>> {\n  const autolinkedModules = await getAutolinkedPackagesAsync(projectRoot, props.platforms);\n\n  return getPrebuildConfig(projectRoot, {\n    ...props,\n    autolinkedModules,\n  });\n}\n\nfunction getPrebuildConfig(\n  projectRoot: string,\n  {\n    platforms,\n    bundleIdentifier,\n    packageName,\n    autolinkedModules,\n    expoUsername,\n  }: {\n    bundleIdentifier?: string;\n    packageName?: string;\n    platforms: ModPlatform[];\n    autolinkedModules?: string[];\n    expoUsername?: string | ((config: ExpoConfig) => string | null);\n  }\n) {\n  // let config: ExpoConfig;\n  let { exp: config, ...rest } = getConfig(projectRoot, {\n    skipSDKVersionRequirement: true,\n    isModdedConfig: true,\n  });\n\n  if (autolinkedModules) {\n    if (!config._internal) {\n      config._internal = {};\n    }\n    config._internal.autolinkedModules = autolinkedModules;\n  }\n\n  const resolvedExpoUsername =\n    typeof expoUsername === 'function'\n      ? expoUsername(config)\n      : // If the user didn't pass a username then fallback on the static cached username.\n        expoUsername ?? getAccountUsername(config);\n\n  // Add all built-in plugins first because they should take\n  // priority over the unversioned plugins.\n  config = withVersionedExpoSDKPlugins(config, {\n    expoUsername: resolvedExpoUsername,\n  });\n  config = withLegacyExpoPlugins(config);\n\n  if (platforms.includes('ios')) {\n    if (!config.ios) config.ios = {};\n    config.ios.bundleIdentifier =\n      bundleIdentifier ?? config.ios.bundleIdentifier ?? `com.placeholder.appid`;\n\n    // Add all built-in plugins\n    config = withIosExpoPlugins(config, {\n      bundleIdentifier: config.ios.bundleIdentifier,\n    });\n  }\n\n  if (platforms.includes('android')) {\n    if (!config.android) config.android = {};\n    config.android.package = packageName ?? config.android.package ?? `com.placeholder.appid`;\n\n    // Add all built-in plugins\n    config = withAndroidExpoPlugins(config, {\n      package: config.android.package,\n    });\n  }\n\n  return { exp: config, ...rest };\n}\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAIA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAOO,eAAeA,sBAAf,CACLC,WADK,EAELC,KAFK,EAQkC;EACvC,MAAMC,iBAAiB,GAAG,MAAM,IAAAC,mDAAA,EAA2BH,WAA3B,EAAwCC,KAAK,CAACG,SAA9C,CAAhC;EAEA,OAAOC,iBAAiB,CAACL,WAAD,EAAc,EACpC,GAAGC,KADiC;IAEpCC;EAFoC,CAAd,CAAxB;AAID;;AAED,SAASG,iBAAT,CACEL,WADF,EAEE;EACEI,SADF;EAEEE,gBAFF;EAGEC,WAHF;EAIEL,iBAJF;EAKEM;AALF,CAFF,EAeE;EACA;EACA,IAAI;IAAEC,GAAG,EAAEC,MAAP;IAAe,GAAGC;EAAlB,IAA2B,IAAAC,mBAAA,EAAUZ,WAAV,EAAuB;IACpDa,yBAAyB,EAAE,IADyB;IAEpDC,cAAc,EAAE;EAFoC,CAAvB,CAA/B;;EAKA,IAAIZ,iBAAJ,EAAuB;IACrB,IAAI,CAACQ,MAAM,CAACK,SAAZ,EAAuB;MACrBL,MAAM,CAACK,SAAP,GAAmB,EAAnB;IACD;;IACDL,MAAM,CAACK,SAAP,CAAiBb,iBAAjB,GAAqCA,iBAArC;EACD;;EAED,MAAMc,oBAAoB,GACxB,OAAOR,YAAP,KAAwB,UAAxB,GACIA,YAAY,CAACE,MAAD,CADhB,GAEI;EACAF,YAHJ,aAGIA,YAHJ,cAGIA,YAHJ,GAGoB,IAAAS,4BAAA,EAAmBP,MAAnB,CAJtB,CAdA,CAoBA;EACA;;EACAA,MAAM,GAAG,IAAAQ,iDAAA,EAA4BR,MAA5B,EAAoC;IAC3CF,YAAY,EAAEQ;EAD6B,CAApC,CAAT;EAGAN,MAAM,GAAG,IAAAS,2CAAA,EAAsBT,MAAtB,CAAT;;EAEA,IAAIN,SAAS,CAACgB,QAAV,CAAmB,KAAnB,CAAJ,EAA+B;IAAA;;IAC7B,IAAI,CAACV,MAAM,CAACW,GAAZ,EAAiBX,MAAM,CAACW,GAAP,GAAa,EAAb;IACjBX,MAAM,CAACW,GAAP,CAAWf,gBAAX,WACEA,gBADF,aACEA,gBADF,cACEA,gBADF,GACsBI,MAAM,CAACW,GAAP,CAAWf,gBADjC,uCACsD,uBADtD,CAF6B,CAK7B;;IACAI,MAAM,GAAG,IAAAY,wCAAA,EAAmBZ,MAAnB,EAA2B;MAClCJ,gBAAgB,EAAEI,MAAM,CAACW,GAAP,CAAWf;IADK,CAA3B,CAAT;EAGD;;EAED,IAAIF,SAAS,CAACgB,QAAV,CAAmB,SAAnB,CAAJ,EAAmC;IAAA;;IACjC,IAAI,CAACV,MAAM,CAACa,OAAZ,EAAqBb,MAAM,CAACa,OAAP,GAAiB,EAAjB;IACrBb,MAAM,CAACa,OAAP,CAAeC,OAAf,YAAyBjB,WAAzB,aAAyBA,WAAzB,cAAyBA,WAAzB,GAAwCG,MAAM,CAACa,OAAP,CAAeC,OAAvD,yCAAmE,uBAAnE,CAFiC,CAIjC;;IACAd,MAAM,GAAG,IAAAe,4CAAA,EAAuBf,MAAvB,EAA+B;MACtCc,OAAO,EAAEd,MAAM,CAACa,OAAP,CAAeC;IADc,CAA/B,CAAT;EAGD;;EAED,OAAO;IAAEf,GAAG,EAAEC,MAAP;IAAe,GAAGC;EAAlB,CAAP;AACD"}