{"version":3,"sources":["../../../../src/plugins/unversioned/expo-facebook/withAndroidFacebook.ts"],"names":["buildResourceItem","AndroidConfig","Resources","removeStringItem","setStringItem","Strings","addMetaDataItemToMainApplication","getMainApplicationOrThrow","prefixAndroidKeys","removeMetaDataItemFromMainApplication","Manifest","CUSTOM_TAB_ACTIVITY","STRING_FACEBOOK_APP_ID","META_APP_ID","META_APP_NAME","META_AUTO_INIT","META_AUTO_LOG_APP_EVENTS","META_AD_ID_COLLECTION","withFacebookAppIdString","config","modResults","applyFacebookAppIdString","withFacebookManifest","setFacebookConfig","buildXMLItem","head","children","$","buildAndroidItem","datum","item","name","getFacebookSchemeActivity","scheme","exported","action","category","data","getFacebookScheme","facebookScheme","getFacebookAppId","facebookAppId","getFacebookDisplayName","facebookDisplayName","getFacebookAutoInitEnabled","facebookAutoInitEnabled","getFacebookAutoLogAppEvents","facebookAutoLogAppEventsEnabled","getFacebookAdvertiserIDCollection","facebookAdvertiserIDCollectionEnabled","ensureFacebookActivity","mainApplication","Array","isArray","activity","filter","push","stringsJSON","appId","value","androidManifest","displayName","autoInitEnabled","autoLogAppEvents","advertiserIdCollection"],"mappings":"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","sourcesContent":["import {\n  AndroidConfig,\n  ConfigPlugin,\n  withAndroidManifest,\n  withStringsXml,\n} from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\n\nconst { buildResourceItem } = AndroidConfig.Resources;\nconst { removeStringItem, setStringItem } = AndroidConfig.Strings;\nconst {\n  addMetaDataItemToMainApplication,\n  getMainApplicationOrThrow,\n  prefixAndroidKeys,\n  removeMetaDataItemFromMainApplication,\n} = AndroidConfig.Manifest;\n\nconst CUSTOM_TAB_ACTIVITY = 'com.facebook.CustomTabActivity';\nconst STRING_FACEBOOK_APP_ID = 'facebook_app_id';\nconst META_APP_ID = 'com.facebook.sdk.ApplicationId';\nconst META_APP_NAME = 'com.facebook.sdk.ApplicationName';\nconst META_AUTO_INIT = 'com.facebook.sdk.AutoInitEnabled';\nconst META_AUTO_LOG_APP_EVENTS = 'com.facebook.sdk.AutoLogAppEventsEnabled';\nconst META_AD_ID_COLLECTION = 'com.facebook.sdk.AdvertiserIDCollectionEnabled';\n\nexport const withFacebookAppIdString: ConfigPlugin = config => {\n  return withStringsXml(config, config => {\n    config.modResults = applyFacebookAppIdString(config, config.modResults);\n    return config;\n  });\n};\n\nexport const withFacebookManifest: ConfigPlugin = config => {\n  return withAndroidManifest(config, config => {\n    config.modResults = setFacebookConfig(config, config.modResults);\n    return config;\n  });\n};\n\nfunction buildXMLItem({\n  head,\n  children,\n}: {\n  head: Record<string, string>;\n  children?: Record<string, string | any[]>;\n}) {\n  return { ...(children ?? {}), $: head };\n}\n\nfunction buildAndroidItem(datum: string | Record<string, any>) {\n  const item = typeof datum === 'string' ? { name: datum } : datum;\n  const head = prefixAndroidKeys(item);\n  return buildXMLItem({ head });\n}\n\nfunction getFacebookSchemeActivity(scheme: string) {\n  /**\n   <activity\n      android:name=\"com.facebook.CustomTabActivity\"\n      android:exported=\"true\">\n      <intent-filter>\n          <action android:name=\"android.intent.action.VIEW\" />\n          <category android:name=\"android.intent.category.DEFAULT\" />\n          <category android:name=\"android.intent.category.BROWSABLE\" />\n          <data android:scheme=\"${scheme}\" />\n      </intent-filter>\n  </activity>\n     */\n  return buildXMLItem({\n    head: prefixAndroidKeys({\n      name: CUSTOM_TAB_ACTIVITY,\n      exported: 'true',\n    }),\n    children: {\n      'intent-filter': [\n        {\n          action: [buildAndroidItem('android.intent.action.VIEW')],\n          category: [\n            buildAndroidItem('android.intent.category.DEFAULT'),\n            buildAndroidItem('android.intent.category.BROWSABLE'),\n          ],\n          data: [buildAndroidItem({ scheme })],\n        },\n      ],\n    },\n  }) as AndroidConfig.Manifest.ManifestActivity;\n}\n\ntype ExpoConfigFacebook = Pick<\n  ExpoConfig,\n  | 'facebookScheme'\n  | 'facebookAdvertiserIDCollectionEnabled'\n  | 'facebookAppId'\n  | 'facebookAutoInitEnabled'\n  | 'facebookAutoLogAppEventsEnabled'\n  | 'facebookDisplayName'\n>;\n\nexport function getFacebookScheme(config: ExpoConfigFacebook) {\n  return config.facebookScheme ?? null;\n}\n\nexport function getFacebookAppId(config: ExpoConfigFacebook) {\n  return config.facebookAppId ?? null;\n}\n\nexport function getFacebookDisplayName(config: ExpoConfigFacebook) {\n  return config.facebookDisplayName ?? null;\n}\nexport function getFacebookAutoInitEnabled(config: ExpoConfigFacebook) {\n  return config.facebookAutoInitEnabled ?? null;\n}\n\nexport function getFacebookAutoLogAppEvents(config: ExpoConfigFacebook) {\n  return config.facebookAutoLogAppEventsEnabled ?? null;\n}\n\nexport function getFacebookAdvertiserIDCollection(config: ExpoConfigFacebook) {\n  return config.facebookAdvertiserIDCollectionEnabled ?? null;\n}\n\nfunction ensureFacebookActivity({\n  mainApplication,\n  scheme,\n}: {\n  mainApplication: AndroidConfig.Manifest.ManifestApplication;\n  scheme: string | null;\n}) {\n  if (Array.isArray(mainApplication.activity)) {\n    // Remove all Facebook CustomTabActivities first\n    mainApplication.activity = mainApplication.activity.filter(activity => {\n      return activity.$?.['android:name'] !== CUSTOM_TAB_ACTIVITY;\n    });\n  } else {\n    mainApplication.activity = [];\n  }\n\n  // If a new scheme is defined, append it to the activity.\n  if (scheme) {\n    mainApplication.activity.push(getFacebookSchemeActivity(scheme));\n  }\n  return mainApplication;\n}\n\nfunction applyFacebookAppIdString(\n  config: ExpoConfigFacebook,\n  stringsJSON: AndroidConfig.Resources.ResourceXML\n) {\n  const appId = getFacebookAppId(config);\n\n  if (appId) {\n    return setStringItem(\n      [buildResourceItem({ name: STRING_FACEBOOK_APP_ID, value: appId })],\n      stringsJSON\n    );\n  }\n  return removeStringItem(STRING_FACEBOOK_APP_ID, stringsJSON);\n}\n\nexport function setFacebookConfig(\n  config: ExpoConfigFacebook,\n  androidManifest: AndroidConfig.Manifest.AndroidManifest\n) {\n  const scheme = getFacebookScheme(config);\n\n  const appId = getFacebookAppId(config);\n  const displayName = getFacebookDisplayName(config);\n  const autoInitEnabled = getFacebookAutoInitEnabled(config);\n  const autoLogAppEvents = getFacebookAutoLogAppEvents(config);\n  const advertiserIdCollection = getFacebookAdvertiserIDCollection(config);\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  let mainApplication = getMainApplicationOrThrow(androidManifest);\n\n  mainApplication = ensureFacebookActivity({ scheme, mainApplication });\n\n  if (appId) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_APP_ID,\n      `@string/${STRING_FACEBOOK_APP_ID}`\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_APP_ID);\n  }\n  if (displayName) {\n    mainApplication = addMetaDataItemToMainApplication(mainApplication, META_APP_NAME, displayName);\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_APP_NAME);\n  }\n  if (autoInitEnabled !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AUTO_INIT,\n      autoInitEnabled ? 'true' : 'false'\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_AUTO_INIT);\n  }\n  if (autoLogAppEvents !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AUTO_LOG_APP_EVENTS,\n      autoLogAppEvents ? 'true' : 'false'\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(\n      mainApplication,\n      META_AUTO_LOG_APP_EVENTS\n    );\n  }\n  if (advertiserIdCollection !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AD_ID_COLLECTION,\n      advertiserIdCollection ? 'true' : 'false'\n    );\n  } else {\n    // eslint-disable-next-line\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_AD_ID_COLLECTION);\n  }\n\n  return androidManifest;\n}\n"],"file":"withAndroidFacebook.js"}