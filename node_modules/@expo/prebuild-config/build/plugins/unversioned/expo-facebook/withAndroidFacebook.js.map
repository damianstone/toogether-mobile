{"version":3,"file":"withAndroidFacebook.js","names":["buildResourceItem","AndroidConfig","Resources","removeStringItem","setStringItem","Strings","addMetaDataItemToMainApplication","getMainApplicationOrThrow","prefixAndroidKeys","removeMetaDataItemFromMainApplication","Manifest","CUSTOM_TAB_ACTIVITY","STRING_FACEBOOK_APP_ID","META_APP_ID","META_APP_NAME","META_AUTO_INIT","META_AUTO_LOG_APP_EVENTS","META_AD_ID_COLLECTION","withFacebookAppIdString","config","withStringsXml","modResults","applyFacebookAppIdString","withFacebookManifest","withAndroidManifest","setFacebookConfig","buildXMLItem","head","children","$","buildAndroidItem","datum","item","name","getFacebookSchemeActivity","scheme","exported","action","category","data","getFacebookScheme","facebookScheme","getFacebookAppId","facebookAppId","getFacebookDisplayName","facebookDisplayName","getFacebookAutoInitEnabled","facebookAutoInitEnabled","getFacebookAutoLogAppEvents","facebookAutoLogAppEventsEnabled","getFacebookAdvertiserIDCollection","facebookAdvertiserIDCollectionEnabled","ensureFacebookActivity","mainApplication","Array","isArray","activity","filter","push","stringsJSON","appId","value","androidManifest","displayName","autoInitEnabled","autoLogAppEvents","advertiserIdCollection"],"sources":["../../../../src/plugins/unversioned/expo-facebook/withAndroidFacebook.ts"],"sourcesContent":["import {\n  AndroidConfig,\n  ConfigPlugin,\n  withAndroidManifest,\n  withStringsXml,\n} from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\n\nconst { buildResourceItem } = AndroidConfig.Resources;\nconst { removeStringItem, setStringItem } = AndroidConfig.Strings;\nconst {\n  addMetaDataItemToMainApplication,\n  getMainApplicationOrThrow,\n  prefixAndroidKeys,\n  removeMetaDataItemFromMainApplication,\n} = AndroidConfig.Manifest;\n\nconst CUSTOM_TAB_ACTIVITY = 'com.facebook.CustomTabActivity';\nconst STRING_FACEBOOK_APP_ID = 'facebook_app_id';\nconst META_APP_ID = 'com.facebook.sdk.ApplicationId';\nconst META_APP_NAME = 'com.facebook.sdk.ApplicationName';\nconst META_AUTO_INIT = 'com.facebook.sdk.AutoInitEnabled';\nconst META_AUTO_LOG_APP_EVENTS = 'com.facebook.sdk.AutoLogAppEventsEnabled';\nconst META_AD_ID_COLLECTION = 'com.facebook.sdk.AdvertiserIDCollectionEnabled';\n\nexport const withFacebookAppIdString: ConfigPlugin = (config) => {\n  return withStringsXml(config, (config) => {\n    config.modResults = applyFacebookAppIdString(config, config.modResults);\n    return config;\n  });\n};\n\nexport const withFacebookManifest: ConfigPlugin = (config) => {\n  return withAndroidManifest(config, (config) => {\n    config.modResults = setFacebookConfig(config, config.modResults);\n    return config;\n  });\n};\n\nfunction buildXMLItem({\n  head,\n  children,\n}: {\n  head: Record<string, string>;\n  children?: Record<string, string | any[]>;\n}) {\n  return { ...(children ?? {}), $: head };\n}\n\nfunction buildAndroidItem(datum: string | Record<string, any>) {\n  const item = typeof datum === 'string' ? { name: datum } : datum;\n  const head = prefixAndroidKeys(item);\n  return buildXMLItem({ head });\n}\n\nfunction getFacebookSchemeActivity(scheme: string) {\n  /**\n   <activity\n      android:name=\"com.facebook.CustomTabActivity\"\n      android:exported=\"true\">\n      <intent-filter>\n          <action android:name=\"android.intent.action.VIEW\" />\n          <category android:name=\"android.intent.category.DEFAULT\" />\n          <category android:name=\"android.intent.category.BROWSABLE\" />\n          <data android:scheme=\"${scheme}\" />\n      </intent-filter>\n  </activity>\n     */\n  return buildXMLItem({\n    head: prefixAndroidKeys({\n      name: CUSTOM_TAB_ACTIVITY,\n      exported: 'true',\n    }),\n    children: {\n      'intent-filter': [\n        {\n          action: [buildAndroidItem('android.intent.action.VIEW')],\n          category: [\n            buildAndroidItem('android.intent.category.DEFAULT'),\n            buildAndroidItem('android.intent.category.BROWSABLE'),\n          ],\n          data: [buildAndroidItem({ scheme })],\n        },\n      ],\n    },\n  }) as AndroidConfig.Manifest.ManifestActivity;\n}\n\ntype ExpoConfigFacebook = Pick<\n  ExpoConfig,\n  | 'facebookScheme'\n  | 'facebookAdvertiserIDCollectionEnabled'\n  | 'facebookAppId'\n  | 'facebookAutoInitEnabled'\n  | 'facebookAutoLogAppEventsEnabled'\n  | 'facebookDisplayName'\n>;\n\nexport function getFacebookScheme(config: ExpoConfigFacebook) {\n  return config.facebookScheme ?? null;\n}\n\nexport function getFacebookAppId(config: ExpoConfigFacebook) {\n  return config.facebookAppId ?? null;\n}\n\nexport function getFacebookDisplayName(config: ExpoConfigFacebook) {\n  return config.facebookDisplayName ?? null;\n}\nexport function getFacebookAutoInitEnabled(config: ExpoConfigFacebook) {\n  return config.facebookAutoInitEnabled ?? null;\n}\n\nexport function getFacebookAutoLogAppEvents(config: ExpoConfigFacebook) {\n  return config.facebookAutoLogAppEventsEnabled ?? null;\n}\n\nexport function getFacebookAdvertiserIDCollection(config: ExpoConfigFacebook) {\n  return config.facebookAdvertiserIDCollectionEnabled ?? null;\n}\n\nfunction ensureFacebookActivity({\n  mainApplication,\n  scheme,\n}: {\n  mainApplication: AndroidConfig.Manifest.ManifestApplication;\n  scheme: string | null;\n}) {\n  if (Array.isArray(mainApplication.activity)) {\n    // Remove all Facebook CustomTabActivities first\n    mainApplication.activity = mainApplication.activity.filter((activity) => {\n      return activity.$?.['android:name'] !== CUSTOM_TAB_ACTIVITY;\n    });\n  } else {\n    mainApplication.activity = [];\n  }\n\n  // If a new scheme is defined, append it to the activity.\n  if (scheme) {\n    mainApplication.activity.push(getFacebookSchemeActivity(scheme));\n  }\n  return mainApplication;\n}\n\nfunction applyFacebookAppIdString(\n  config: ExpoConfigFacebook,\n  stringsJSON: AndroidConfig.Resources.ResourceXML\n) {\n  const appId = getFacebookAppId(config);\n\n  if (appId) {\n    return setStringItem(\n      [buildResourceItem({ name: STRING_FACEBOOK_APP_ID, value: appId })],\n      stringsJSON\n    );\n  }\n  return removeStringItem(STRING_FACEBOOK_APP_ID, stringsJSON);\n}\n\nexport function setFacebookConfig(\n  config: ExpoConfigFacebook,\n  androidManifest: AndroidConfig.Manifest.AndroidManifest\n) {\n  const scheme = getFacebookScheme(config);\n\n  const appId = getFacebookAppId(config);\n  const displayName = getFacebookDisplayName(config);\n  const autoInitEnabled = getFacebookAutoInitEnabled(config);\n  const autoLogAppEvents = getFacebookAutoLogAppEvents(config);\n  const advertiserIdCollection = getFacebookAdvertiserIDCollection(config);\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  let mainApplication = getMainApplicationOrThrow(androidManifest);\n\n  mainApplication = ensureFacebookActivity({ scheme, mainApplication });\n\n  if (appId) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_APP_ID,\n      `@string/${STRING_FACEBOOK_APP_ID}`\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_APP_ID);\n  }\n  if (displayName) {\n    mainApplication = addMetaDataItemToMainApplication(mainApplication, META_APP_NAME, displayName);\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_APP_NAME);\n  }\n  if (autoInitEnabled !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AUTO_INIT,\n      autoInitEnabled ? 'true' : 'false'\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_AUTO_INIT);\n  }\n  if (autoLogAppEvents !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AUTO_LOG_APP_EVENTS,\n      autoLogAppEvents ? 'true' : 'false'\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(\n      mainApplication,\n      META_AUTO_LOG_APP_EVENTS\n    );\n  }\n  if (advertiserIdCollection !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AD_ID_COLLECTION,\n      advertiserIdCollection ? 'true' : 'false'\n    );\n  } else {\n    // eslint-disable-next-line\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_AD_ID_COLLECTION);\n  }\n\n  return androidManifest;\n}\n"],"mappings":"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"}