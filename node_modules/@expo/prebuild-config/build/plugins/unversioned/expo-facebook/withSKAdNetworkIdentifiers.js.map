{"version":3,"file":"withSKAdNetworkIdentifiers.js","names":["withSKAdNetworkIdentifiers","config","identifiers","facebookAppId","getFacebookAppId","ios","infoPlist","Array","isArray","SKAdNetworkItems","existingIds","map","item","SKAdNetworkIdentifier","filter","Boolean","Set","id","lower","toLowerCase","includes","push"],"sources":["../../../../src/plugins/unversioned/expo-facebook/withSKAdNetworkIdentifiers.ts"],"sourcesContent":["import { ConfigPlugin } from '@expo/config-plugins';\n\nimport { getFacebookAppId } from './withIosFacebook';\n\n/**\n * Plugin to add [`SKAdNetworkIdentifier`](https://developer.apple.com/documentation/storekit/skadnetwork/configuring_the_participating_apps)s to the Info.plist safely.\n *\n *\n * @param config\n * @param props.identifiers array of lowercase string ids to push to the `SKAdNetworkItems` array in the `Info.plist`.\n */\nexport const withSKAdNetworkIdentifiers: ConfigPlugin<string[]> = (config, identifiers) => {\n  // Only add the iOS ad network values if facebookAppId is defined.\n  const facebookAppId = getFacebookAppId(config);\n  if (!facebookAppId) {\n    return config;\n  }\n\n  if (!config.ios) {\n    config.ios = {};\n  }\n  if (!config.ios.infoPlist) {\n    config.ios.infoPlist = {};\n  }\n  if (!Array.isArray(config.ios.infoPlist.SKAdNetworkItems)) {\n    config.ios.infoPlist.SKAdNetworkItems = [];\n  }\n\n  // Get ids\n  let existingIds = config.ios.infoPlist.SKAdNetworkItems.map(\n    (item: any) => item?.SKAdNetworkIdentifier ?? null\n  ).filter(Boolean) as string[];\n  // remove duplicates\n  existingIds = [...new Set(existingIds)];\n\n  for (const id of identifiers) {\n    // Must be lowercase\n    const lower = id.toLowerCase();\n    if (!existingIds.includes(lower)) {\n      config.ios.infoPlist.SKAdNetworkItems.push({\n        SKAdNetworkIdentifier: lower,\n      });\n    }\n  }\n\n  return config;\n};\n"],"mappings":";;;;;;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMA,0BAAkD,GAAG,CAACC,MAAD,EAASC,WAAT,KAAyB;EACzF;EACA,MAAMC,aAAa,GAAG,IAAAC,mCAAA,EAAiBH,MAAjB,CAAtB;;EACA,IAAI,CAACE,aAAL,EAAoB;IAClB,OAAOF,MAAP;EACD;;EAED,IAAI,CAACA,MAAM,CAACI,GAAZ,EAAiB;IACfJ,MAAM,CAACI,GAAP,GAAa,EAAb;EACD;;EACD,IAAI,CAACJ,MAAM,CAACI,GAAP,CAAWC,SAAhB,EAA2B;IACzBL,MAAM,CAACI,GAAP,CAAWC,SAAX,GAAuB,EAAvB;EACD;;EACD,IAAI,CAACC,KAAK,CAACC,OAAN,CAAcP,MAAM,CAACI,GAAP,CAAWC,SAAX,CAAqBG,gBAAnC,CAAL,EAA2D;IACzDR,MAAM,CAACI,GAAP,CAAWC,SAAX,CAAqBG,gBAArB,GAAwC,EAAxC;EACD,CAfwF,CAiBzF;;;EACA,IAAIC,WAAW,GAAGT,MAAM,CAACI,GAAP,CAAWC,SAAX,CAAqBG,gBAArB,CAAsCE,GAAtC,CACfC,IAAD;IAAA;;IAAA,gCAAeA,IAAf,aAAeA,IAAf,uBAAeA,IAAI,CAAEC,qBAArB,yEAA8C,IAA9C;EAAA,CADgB,EAEhBC,MAFgB,CAETC,OAFS,CAAlB,CAlByF,CAqBzF;;EACAL,WAAW,GAAG,CAAC,GAAG,IAAIM,GAAJ,CAAQN,WAAR,CAAJ,CAAd;;EAEA,KAAK,MAAMO,EAAX,IAAiBf,WAAjB,EAA8B;IAC5B;IACA,MAAMgB,KAAK,GAAGD,EAAE,CAACE,WAAH,EAAd;;IACA,IAAI,CAACT,WAAW,CAACU,QAAZ,CAAqBF,KAArB,CAAL,EAAkC;MAChCjB,MAAM,CAACI,GAAP,CAAWC,SAAX,CAAqBG,gBAArB,CAAsCY,IAAtC,CAA2C;QACzCR,qBAAqB,EAAEK;MADkB,CAA3C;IAGD;EACF;;EAED,OAAOjB,MAAP;AACD,CAnCM"}