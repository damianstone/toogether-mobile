{"version":3,"file":"withIosFacebook.js","names":["appendScheme","IOSConfig","Scheme","fbSchemes","withIosFacebook","config","withInfoPlist","modResults","setFacebookConfig","getFacebookScheme","facebookScheme","getFacebookAppId","facebookAppId","getFacebookDisplayName","facebookDisplayName","getFacebookAutoInitEnabled","facebookAutoInitEnabled","getFacebookAutoLogAppEvents","facebookAutoLogAppEventsEnabled","getFacebookAdvertiserIDCollection","facebookAdvertiserIDCollectionEnabled","infoPlist","setFacebookAppId","setFacebookApplicationQuerySchemes","setFacebookDisplayName","setFacebookAutoInitEnabled","setFacebookAutoLogAppEventsEnabled","setFacebookAdvertiserIDCollectionEnabled","setFacebookScheme","FacebookAutoInitEnabled","FacebookAutoLogAppEventsEnabled","FacebookAdvertiserIDCollectionEnabled","FacebookAppID","FacebookDisplayName","existingSchemes","LSApplicationQueriesSchemes","includes","length","restInfoPlist","scheme","index","findIndex","s","splice","updatedSchemes"],"sources":["../../../../src/plugins/unversioned/expo-facebook/withIosFacebook.ts"],"sourcesContent":["import { ConfigPlugin, InfoPlist, IOSConfig, withInfoPlist } from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\n\nconst { appendScheme } = IOSConfig.Scheme;\n\ntype ExpoConfigFacebook = Pick<\n  ExpoConfig,\n  | 'facebookScheme'\n  | 'facebookAdvertiserIDCollectionEnabled'\n  | 'facebookAppId'\n  | 'facebookAutoInitEnabled'\n  | 'facebookAutoLogAppEventsEnabled'\n  | 'facebookDisplayName'\n>;\n\nconst fbSchemes = ['fbapi', 'fb-messenger-api', 'fbauth2', 'fbshareextension'];\n\nexport const withIosFacebook: ConfigPlugin = (config) => {\n  return withInfoPlist(config, (config) => {\n    config.modResults = setFacebookConfig(config, config.modResults);\n    return config;\n  });\n};\n\n/**\n * Getters\n * TODO: these getters are the same between ios/android, we could reuse them\n */\n\nexport function getFacebookScheme(config: ExpoConfigFacebook) {\n  return config.facebookScheme ?? null;\n}\n\nexport function getFacebookAppId(config: Pick<ExpoConfigFacebook, 'facebookAppId'>) {\n  return config.facebookAppId ?? null;\n}\n\nexport function getFacebookDisplayName(config: ExpoConfigFacebook) {\n  return config.facebookDisplayName ?? null;\n}\n\nexport function getFacebookAutoInitEnabled(config: ExpoConfigFacebook) {\n  return config.facebookAutoInitEnabled ?? null;\n}\n\nexport function getFacebookAutoLogAppEvents(config: ExpoConfigFacebook) {\n  return config.facebookAutoLogAppEventsEnabled ?? null;\n}\n\nexport function getFacebookAdvertiserIDCollection(config: ExpoConfigFacebook) {\n  return config.facebookAdvertiserIDCollectionEnabled ?? null;\n}\n\n/**\n * Setters\n */\n\nexport function setFacebookConfig(config: ExpoConfigFacebook, infoPlist: InfoPlist) {\n  infoPlist = setFacebookAppId(config, infoPlist);\n  infoPlist = setFacebookApplicationQuerySchemes(config, infoPlist);\n  infoPlist = setFacebookDisplayName(config, infoPlist);\n  infoPlist = setFacebookAutoInitEnabled(config, infoPlist);\n  infoPlist = setFacebookAutoLogAppEventsEnabled(config, infoPlist);\n  infoPlist = setFacebookAdvertiserIDCollectionEnabled(config, infoPlist);\n  infoPlist = setFacebookScheme(config, infoPlist);\n  return infoPlist;\n}\n\nexport function setFacebookScheme(config: ExpoConfigFacebook, infoPlist: InfoPlist) {\n  const facebookScheme = getFacebookScheme(config);\n  return appendScheme(facebookScheme, infoPlist);\n}\n\nexport function setFacebookAutoInitEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAutoInitEnabled, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAutoInitEnabled = getFacebookAutoInitEnabled(config);\n\n  if (facebookAutoInitEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAutoInitEnabled: facebookAutoInitEnabled,\n  };\n}\n\nexport function setFacebookAutoLogAppEventsEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAutoLogAppEventsEnabled, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAutoLogAppEventsEnabled = getFacebookAutoLogAppEvents(config);\n\n  if (facebookAutoLogAppEventsEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAutoLogAppEventsEnabled: facebookAutoLogAppEventsEnabled,\n  };\n}\n\nexport function setFacebookAdvertiserIDCollectionEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAdvertiserIDCollectionEnabled, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAdvertiserIDCollectionEnabled = getFacebookAdvertiserIDCollection(config);\n\n  if (facebookAdvertiserIDCollectionEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAdvertiserIDCollectionEnabled: facebookAdvertiserIDCollectionEnabled,\n  };\n}\n\nexport function setFacebookAppId(\n  config: Pick<ExpoConfigFacebook, 'facebookAppId'>,\n  { FacebookAppID, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAppId = getFacebookAppId(config);\n  if (facebookAppId) {\n    return {\n      ...infoPlist,\n      FacebookAppID: facebookAppId,\n    };\n  }\n\n  return infoPlist;\n}\n\nexport function setFacebookDisplayName(\n  config: ExpoConfigFacebook,\n  { FacebookDisplayName, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookDisplayName = getFacebookDisplayName(config);\n\n  if (facebookDisplayName) {\n    return {\n      ...infoPlist,\n      FacebookDisplayName: facebookDisplayName,\n    };\n  }\n\n  return infoPlist;\n}\n\nexport function setFacebookApplicationQuerySchemes(\n  config: Pick<ExpoConfigFacebook, 'facebookAppId'>,\n  infoPlist: InfoPlist\n): InfoPlist {\n  const facebookAppId = getFacebookAppId(config);\n\n  const existingSchemes = infoPlist.LSApplicationQueriesSchemes || [];\n\n  if (facebookAppId && existingSchemes.includes('fbapi')) {\n    // already included, no need to add again\n    return infoPlist;\n  } else if (!facebookAppId && !existingSchemes.length) {\n    // already removed, no need to strip again\n    const { LSApplicationQueriesSchemes, ...restInfoPlist } = infoPlist;\n    if (LSApplicationQueriesSchemes?.length) {\n      return infoPlist;\n    } else {\n      // Return without the empty LSApplicationQueriesSchemes array.\n      return restInfoPlist;\n    }\n  }\n\n  // Remove all schemes\n  for (const scheme of fbSchemes) {\n    const index = existingSchemes.findIndex((s) => s === scheme);\n    if (index > -1) {\n      existingSchemes.splice(index, 1);\n    }\n  }\n\n  if (!facebookAppId) {\n    // Run again to ensure the LSApplicationQueriesSchemes array is stripped if needed.\n    infoPlist.LSApplicationQueriesSchemes = existingSchemes;\n    if (!infoPlist.LSApplicationQueriesSchemes.length) {\n      delete infoPlist.LSApplicationQueriesSchemes;\n    }\n    return infoPlist;\n  }\n\n  // TODO: it's actually necessary to add more query schemes (specific to the\n  // app) to support all of the features that the Facebook SDK provides, should\n  // we sync those here too?\n  const updatedSchemes = [...existingSchemes, ...fbSchemes];\n\n  return {\n    ...infoPlist,\n    LSApplicationQueriesSchemes: updatedSchemes,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAGA,MAAM;EAAEA;AAAF,IAAmBC,0BAAA,CAAUC,MAAnC;;AAYA,MAAMC,SAAS,GAAG,CAAC,OAAD,EAAU,kBAAV,EAA8B,SAA9B,EAAyC,kBAAzC,CAAlB;;AAEO,MAAMC,eAA6B,GAAIC,MAAD,IAAY;EACvD,OAAO,IAAAC,8BAAA,EAAcD,MAAd,EAAuBA,MAAD,IAAY;IACvCA,MAAM,CAACE,UAAP,GAAoBC,iBAAiB,CAACH,MAAD,EAASA,MAAM,CAACE,UAAhB,CAArC;IACA,OAAOF,MAAP;EACD,CAHM,CAAP;AAID,CALM;AAOP;AACA;AACA;AACA;;;;;AAEO,SAASI,iBAAT,CAA2BJ,MAA3B,EAAuD;EAAA;;EAC5D,gCAAOA,MAAM,CAACK,cAAd,yEAAgC,IAAhC;AACD;;AAEM,SAASC,gBAAT,CAA0BN,MAA1B,EAA6E;EAAA;;EAClF,gCAAOA,MAAM,CAACO,aAAd,yEAA+B,IAA/B;AACD;;AAEM,SAASC,sBAAT,CAAgCR,MAAhC,EAA4D;EAAA;;EACjE,gCAAOA,MAAM,CAACS,mBAAd,yEAAqC,IAArC;AACD;;AAEM,SAASC,0BAAT,CAAoCV,MAApC,EAAgE;EAAA;;EACrE,gCAAOA,MAAM,CAACW,uBAAd,yEAAyC,IAAzC;AACD;;AAEM,SAASC,2BAAT,CAAqCZ,MAArC,EAAiE;EAAA;;EACtE,gCAAOA,MAAM,CAACa,+BAAd,yEAAiD,IAAjD;AACD;;AAEM,SAASC,iCAAT,CAA2Cd,MAA3C,EAAuE;EAAA;;EAC5E,gCAAOA,MAAM,CAACe,qCAAd,yEAAuD,IAAvD;AACD;AAED;AACA;AACA;;;AAEO,SAASZ,iBAAT,CAA2BH,MAA3B,EAAuDgB,SAAvD,EAA6E;EAClFA,SAAS,GAAGC,gBAAgB,CAACjB,MAAD,EAASgB,SAAT,CAA5B;EACAA,SAAS,GAAGE,kCAAkC,CAAClB,MAAD,EAASgB,SAAT,CAA9C;EACAA,SAAS,GAAGG,sBAAsB,CAACnB,MAAD,EAASgB,SAAT,CAAlC;EACAA,SAAS,GAAGI,0BAA0B,CAACpB,MAAD,EAASgB,SAAT,CAAtC;EACAA,SAAS,GAAGK,kCAAkC,CAACrB,MAAD,EAASgB,SAAT,CAA9C;EACAA,SAAS,GAAGM,wCAAwC,CAACtB,MAAD,EAASgB,SAAT,CAApD;EACAA,SAAS,GAAGO,iBAAiB,CAACvB,MAAD,EAASgB,SAAT,CAA7B;EACA,OAAOA,SAAP;AACD;;AAEM,SAASO,iBAAT,CAA2BvB,MAA3B,EAAuDgB,SAAvD,EAA6E;EAClF,MAAMX,cAAc,GAAGD,iBAAiB,CAACJ,MAAD,CAAxC;EACA,OAAOL,YAAY,CAACU,cAAD,EAAiBW,SAAjB,CAAnB;AACD;;AAEM,SAASI,0BAAT,CACLpB,MADK,EAEL;EAAEwB,uBAAF;EAA2B,GAAGR;AAA9B,CAFK,EAGM;EACX,MAAML,uBAAuB,GAAGD,0BAA0B,CAACV,MAAD,CAA1D;;EAEA,IAAIW,uBAAuB,KAAK,IAAhC,EAAsC;IACpC,OAAOK,SAAP;EACD;;EAED,OAAO,EACL,GAAGA,SADE;IAELQ,uBAAuB,EAAEb;EAFpB,CAAP;AAID;;AAEM,SAASU,kCAAT,CACLrB,MADK,EAEL;EAAEyB,+BAAF;EAAmC,GAAGT;AAAtC,CAFK,EAGM;EACX,MAAMH,+BAA+B,GAAGD,2BAA2B,CAACZ,MAAD,CAAnE;;EAEA,IAAIa,+BAA+B,KAAK,IAAxC,EAA8C;IAC5C,OAAOG,SAAP;EACD;;EAED,OAAO,EACL,GAAGA,SADE;IAELS,+BAA+B,EAAEZ;EAF5B,CAAP;AAID;;AAEM,SAASS,wCAAT,CACLtB,MADK,EAEL;EAAE0B,qCAAF;EAAyC,GAAGV;AAA5C,CAFK,EAGM;EACX,MAAMD,qCAAqC,GAAGD,iCAAiC,CAACd,MAAD,CAA/E;;EAEA,IAAIe,qCAAqC,KAAK,IAA9C,EAAoD;IAClD,OAAOC,SAAP;EACD;;EAED,OAAO,EACL,GAAGA,SADE;IAELU,qCAAqC,EAAEX;EAFlC,CAAP;AAID;;AAEM,SAASE,gBAAT,CACLjB,MADK,EAEL;EAAE2B,aAAF;EAAiB,GAAGX;AAApB,CAFK,EAGM;EACX,MAAMT,aAAa,GAAGD,gBAAgB,CAACN,MAAD,CAAtC;;EACA,IAAIO,aAAJ,EAAmB;IACjB,OAAO,EACL,GAAGS,SADE;MAELW,aAAa,EAAEpB;IAFV,CAAP;EAID;;EAED,OAAOS,SAAP;AACD;;AAEM,SAASG,sBAAT,CACLnB,MADK,EAEL;EAAE4B,mBAAF;EAAuB,GAAGZ;AAA1B,CAFK,EAGM;EACX,MAAMP,mBAAmB,GAAGD,sBAAsB,CAACR,MAAD,CAAlD;;EAEA,IAAIS,mBAAJ,EAAyB;IACvB,OAAO,EACL,GAAGO,SADE;MAELY,mBAAmB,EAAEnB;IAFhB,CAAP;EAID;;EAED,OAAOO,SAAP;AACD;;AAEM,SAASE,kCAAT,CACLlB,MADK,EAELgB,SAFK,EAGM;EACX,MAAMT,aAAa,GAAGD,gBAAgB,CAACN,MAAD,CAAtC;EAEA,MAAM6B,eAAe,GAAGb,SAAS,CAACc,2BAAV,IAAyC,EAAjE;;EAEA,IAAIvB,aAAa,IAAIsB,eAAe,CAACE,QAAhB,CAAyB,OAAzB,CAArB,EAAwD;IACtD;IACA,OAAOf,SAAP;EACD,CAHD,MAGO,IAAI,CAACT,aAAD,IAAkB,CAACsB,eAAe,CAACG,MAAvC,EAA+C;IACpD;IACA,MAAM;MAAEF,2BAAF;MAA+B,GAAGG;IAAlC,IAAoDjB,SAA1D;;IACA,IAAIc,2BAAJ,aAAIA,2BAAJ,eAAIA,2BAA2B,CAAEE,MAAjC,EAAyC;MACvC,OAAOhB,SAAP;IACD,CAFD,MAEO;MACL;MACA,OAAOiB,aAAP;IACD;EACF,CAjBU,CAmBX;;;EACA,KAAK,MAAMC,MAAX,IAAqBpC,SAArB,EAAgC;IAC9B,MAAMqC,KAAK,GAAGN,eAAe,CAACO,SAAhB,CAA2BC,CAAD,IAAOA,CAAC,KAAKH,MAAvC,CAAd;;IACA,IAAIC,KAAK,GAAG,CAAC,CAAb,EAAgB;MACdN,eAAe,CAACS,MAAhB,CAAuBH,KAAvB,EAA8B,CAA9B;IACD;EACF;;EAED,IAAI,CAAC5B,aAAL,EAAoB;IAClB;IACAS,SAAS,CAACc,2BAAV,GAAwCD,eAAxC;;IACA,IAAI,CAACb,SAAS,CAACc,2BAAV,CAAsCE,MAA3C,EAAmD;MACjD,OAAOhB,SAAS,CAACc,2BAAjB;IACD;;IACD,OAAOd,SAAP;EACD,CAlCU,CAoCX;EACA;EACA;;;EACA,MAAMuB,cAAc,GAAG,CAAC,GAAGV,eAAJ,EAAqB,GAAG/B,SAAxB,CAAvB;EAEA,OAAO,EACL,GAAGkB,SADE;IAELc,2BAA2B,EAAES;EAFxB,CAAP;AAID"}