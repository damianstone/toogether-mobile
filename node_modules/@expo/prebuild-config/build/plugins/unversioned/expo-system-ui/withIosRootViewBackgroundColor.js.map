{"version":3,"file":"withIosRootViewBackgroundColor.js","names":["BACKGROUND_COLOR_KEY","debug","require","withIosRootViewBackgroundColor","config","withInfoPlist","shouldUseLegacyBehavior","modResults","setRootViewBackgroundColor","warnSystemUIMissing","sdkVersion","semver","lt","backgroundColor","getRootViewBackgroundColor","WarningAggregator","addWarningIOS","infoPlist","color","normalizeColor","Error","ios"],"sources":["../../../../src/plugins/unversioned/expo-system-ui/withIosRootViewBackgroundColor.ts"],"sourcesContent":["import { ConfigPlugin, InfoPlist, WarningAggregator, withInfoPlist } from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\n// @ts-ignore: uses flow\nimport normalizeColor from '@react-native/normalize-color';\nimport semver from 'semver';\n\n// Maps to the template AppDelegate.m\nconst BACKGROUND_COLOR_KEY = 'RCTRootViewBackgroundColor';\n\nconst debug = require('debug')('expo:system-ui:plugin:ios');\n\nexport const withIosRootViewBackgroundColor: ConfigPlugin = (config) => {\n  config = withInfoPlist(config, (config) => {\n    if (shouldUseLegacyBehavior(config)) {\n      config.modResults = setRootViewBackgroundColor(config, config.modResults);\n    } else {\n      warnSystemUIMissing(config);\n    }\n    return config;\n  });\n  return config;\n};\n\n/** The template was changed in SDK 43 to move the background color logic to the `expo-system-ui` module */\nexport function shouldUseLegacyBehavior(config: Pick<ExpoConfig, 'sdkVersion'>): boolean {\n  try {\n    return !!(config.sdkVersion && semver.lt(config.sdkVersion, '44.0.0'));\n  } catch {}\n  return false;\n}\n\nexport function warnSystemUIMissing(\n  config: Pick<ExpoConfig, 'sdkVersion' | 'backgroundColor' | 'ios'>\n) {\n  const backgroundColor = getRootViewBackgroundColor(config);\n\n  if (backgroundColor) {\n    // Background color needs to be set programmatically\n    WarningAggregator.addWarningIOS(\n      'ios.backgroundColor',\n      'Install expo-system-ui to enable this feature',\n      'https://docs.expo.dev/build-reference/migrating/#expo-config--backgroundcolor--depends-on'\n    );\n  }\n}\n\nexport function setRootViewBackgroundColor(\n  config: Pick<ExpoConfig, 'backgroundColor' | 'ios'>,\n  infoPlist: InfoPlist\n): InfoPlist {\n  const backgroundColor = getRootViewBackgroundColor(config);\n  if (!backgroundColor) {\n    delete infoPlist[BACKGROUND_COLOR_KEY];\n  } else {\n    let color = normalizeColor(backgroundColor);\n    if (!color) {\n      throw new Error('Invalid background color on iOS');\n    }\n    color = ((color << 24) | (color >>> 8)) >>> 0;\n    infoPlist[BACKGROUND_COLOR_KEY] = color;\n\n    debug(`Convert color: ${backgroundColor} -> ${color}`);\n  }\n  return infoPlist;\n}\n\nexport function getRootViewBackgroundColor(config: Pick<ExpoConfig, 'ios' | 'backgroundColor'>) {\n  return config.ios?.backgroundColor || config.backgroundColor || null;\n}\n"],"mappings":";;;;;;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAGA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AAFA;AAIA;AACA,MAAMA,oBAAoB,GAAG,4BAA7B;;AAEA,MAAMC,KAAK,GAAGC,OAAO,CAAC,OAAD,CAAP,CAAiB,2BAAjB,CAAd;;AAEO,MAAMC,8BAA4C,GAAIC,MAAD,IAAY;EACtEA,MAAM,GAAG,IAAAC,8BAAA,EAAcD,MAAd,EAAuBA,MAAD,IAAY;IACzC,IAAIE,uBAAuB,CAACF,MAAD,CAA3B,EAAqC;MACnCA,MAAM,CAACG,UAAP,GAAoBC,0BAA0B,CAACJ,MAAD,EAASA,MAAM,CAACG,UAAhB,CAA9C;IACD,CAFD,MAEO;MACLE,mBAAmB,CAACL,MAAD,CAAnB;IACD;;IACD,OAAOA,MAAP;EACD,CAPQ,CAAT;EAQA,OAAOA,MAAP;AACD,CAVM;AAYP;;;;;AACO,SAASE,uBAAT,CAAiCF,MAAjC,EAAkF;EACvF,IAAI;IACF,OAAO,CAAC,EAAEA,MAAM,CAACM,UAAP,IAAqBC,iBAAA,CAAOC,EAAP,CAAUR,MAAM,CAACM,UAAjB,EAA6B,QAA7B,CAAvB,CAAR;EACD,CAFD,CAEE,MAAM,CAAE;;EACV,OAAO,KAAP;AACD;;AAEM,SAASD,mBAAT,CACLL,MADK,EAEL;EACA,MAAMS,eAAe,GAAGC,0BAA0B,CAACV,MAAD,CAAlD;;EAEA,IAAIS,eAAJ,EAAqB;IACnB;IACAE,kCAAA,CAAkBC,aAAlB,CACE,qBADF,EAEE,+CAFF,EAGE,2FAHF;EAKD;AACF;;AAEM,SAASR,0BAAT,CACLJ,MADK,EAELa,SAFK,EAGM;EACX,MAAMJ,eAAe,GAAGC,0BAA0B,CAACV,MAAD,CAAlD;;EACA,IAAI,CAACS,eAAL,EAAsB;IACpB,OAAOI,SAAS,CAACjB,oBAAD,CAAhB;EACD,CAFD,MAEO;IACL,IAAIkB,KAAK,GAAG,IAAAC,yBAAA,EAAeN,eAAf,CAAZ;;IACA,IAAI,CAACK,KAAL,EAAY;MACV,MAAM,IAAIE,KAAJ,CAAU,iCAAV,CAAN;IACD;;IACDF,KAAK,GAAG,CAAEA,KAAK,IAAI,EAAV,GAAiBA,KAAK,KAAK,CAA5B,MAAoC,CAA5C;IACAD,SAAS,CAACjB,oBAAD,CAAT,GAAkCkB,KAAlC;IAEAjB,KAAK,CAAE,kBAAiBY,eAAgB,OAAMK,KAAM,EAA/C,CAAL;EACD;;EACD,OAAOD,SAAP;AACD;;AAEM,SAASH,0BAAT,CAAoCV,MAApC,EAAyF;EAAA;;EAC9F,OAAO,gBAAAA,MAAM,CAACiB,GAAP,4DAAYR,eAAZ,KAA+BT,MAAM,CAACS,eAAtC,IAAyD,IAAhE;AACD"}