{"version":3,"file":"ProvisioningProfile.js","names":["setProvisioningProfileForPbxproj","projectRoot","targetName","profileName","appleTeamId","buildConfiguration","project","getPbxproj","nativeTargetEntry","findNativeTargetByName","findFirstNativeTarget","nativeTargetId","nativeTarget","quotedAppleTeamId","ensureQuotes","getBuildConfigurationsForListId","buildConfigurationList","filter","item","trimQuotes","name","forEach","buildSettings","PROVISIONING_PROFILE_SPECIFIER","DEVELOPMENT_TEAM","CODE_SIGN_IDENTITY","CODE_SIGN_STYLE","Object","entries","getProjectSection","isNotComment","attributes","TargetAttributes","DevelopmentTeam","ProvisioningStyle","fs","writeFileSync","filepath","writeSync","value","match"],"sources":["../../src/ios/ProvisioningProfile.ts"],"sourcesContent":["import fs from 'fs';\n\nimport { findFirstNativeTarget, findNativeTargetByName } from './Target';\nimport {\n  ConfigurationSectionEntry,\n  getBuildConfigurationsForListId,\n  getPbxproj,\n  getProjectSection,\n  isNotComment,\n  ProjectSectionEntry,\n} from './utils/Xcodeproj';\nimport { trimQuotes } from './utils/string';\n\ntype ProvisioningProfileSettings = {\n  targetName?: string;\n  appleTeamId: string;\n  profileName: string;\n  buildConfiguration?: string;\n};\n\nexport function setProvisioningProfileForPbxproj(\n  projectRoot: string,\n  {\n    targetName,\n    profileName,\n    appleTeamId,\n    buildConfiguration = 'Release',\n  }: ProvisioningProfileSettings\n): void {\n  const project = getPbxproj(projectRoot);\n\n  const nativeTargetEntry = targetName\n    ? findNativeTargetByName(project, targetName)\n    : findFirstNativeTarget(project);\n  const [nativeTargetId, nativeTarget] = nativeTargetEntry;\n\n  const quotedAppleTeamId = ensureQuotes(appleTeamId);\n\n  getBuildConfigurationsForListId(project, nativeTarget.buildConfigurationList)\n    .filter(([, item]: ConfigurationSectionEntry) => trimQuotes(item.name) === buildConfiguration)\n    .forEach(([, item]: ConfigurationSectionEntry) => {\n      item.buildSettings.PROVISIONING_PROFILE_SPECIFIER = `\"${profileName}\"`;\n      item.buildSettings.DEVELOPMENT_TEAM = quotedAppleTeamId;\n      item.buildSettings.CODE_SIGN_IDENTITY = '\"iPhone Distribution\"';\n      item.buildSettings.CODE_SIGN_STYLE = 'Manual';\n    });\n\n  Object.entries(getProjectSection(project))\n    .filter(isNotComment)\n    .forEach(([, item]: ProjectSectionEntry) => {\n      if (!item.attributes.TargetAttributes[nativeTargetId]) {\n        item.attributes.TargetAttributes[nativeTargetId] = {};\n      }\n      item.attributes.TargetAttributes[nativeTargetId].DevelopmentTeam = quotedAppleTeamId;\n      item.attributes.TargetAttributes[nativeTargetId].ProvisioningStyle = 'Manual';\n    });\n\n  fs.writeFileSync(project.filepath, project.writeSync());\n}\n\nconst ensureQuotes = (value: string) => {\n  if (!value.match(/^['\"]/)) {\n    return `\"${value}\"`;\n  }\n  return value;\n};\n"],"mappings":";;;;;;;AAAA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAEA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AACA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;AAQA;EAAA;;EAAA;IAAA;EAAA;;EAAA;AAAA;;;;AASO,SAASA,gCAAT,CACLC,WADK,EAEL;EACEC,UADF;EAEEC,WAFF;EAGEC,WAHF;EAIEC,kBAAkB,GAAG;AAJvB,CAFK,EAQC;EACN,MAAMC,OAAO,GAAG,IAAAC,uBAAA,EAAWN,WAAX,CAAhB;EAEA,MAAMO,iBAAiB,GAAGN,UAAU,GAChC,IAAAO,gCAAA,EAAuBH,OAAvB,EAAgCJ,UAAhC,CADgC,GAEhC,IAAAQ,+BAAA,EAAsBJ,OAAtB,CAFJ;EAGA,MAAM,CAACK,cAAD,EAAiBC,YAAjB,IAAiCJ,iBAAvC;EAEA,MAAMK,iBAAiB,GAAGC,YAAY,CAACV,WAAD,CAAtC;EAEA,IAAAW,4CAAA,EAAgCT,OAAhC,EAAyCM,YAAY,CAACI,sBAAtD,EACGC,MADH,CACU,CAAC,GAAGC,IAAH,CAAD,KAAyC,IAAAC,oBAAA,EAAWD,IAAI,CAACE,IAAhB,MAA0Bf,kBAD7E,EAEGgB,OAFH,CAEW,CAAC,GAAGH,IAAH,CAAD,KAAyC;IAChDA,IAAI,CAACI,aAAL,CAAmBC,8BAAnB,GAAqD,IAAGpB,WAAY,GAApE;IACAe,IAAI,CAACI,aAAL,CAAmBE,gBAAnB,GAAsCX,iBAAtC;IACAK,IAAI,CAACI,aAAL,CAAmBG,kBAAnB,GAAwC,uBAAxC;IACAP,IAAI,CAACI,aAAL,CAAmBI,eAAnB,GAAqC,QAArC;EACD,CAPH;EASAC,MAAM,CAACC,OAAP,CAAe,IAAAC,8BAAA,EAAkBvB,OAAlB,CAAf,EACGW,MADH,CACUa,yBADV,EAEGT,OAFH,CAEW,CAAC,GAAGH,IAAH,CAAD,KAAmC;IAC1C,IAAI,CAACA,IAAI,CAACa,UAAL,CAAgBC,gBAAhB,CAAiCrB,cAAjC,CAAL,EAAuD;MACrDO,IAAI,CAACa,UAAL,CAAgBC,gBAAhB,CAAiCrB,cAAjC,IAAmD,EAAnD;IACD;;IACDO,IAAI,CAACa,UAAL,CAAgBC,gBAAhB,CAAiCrB,cAAjC,EAAiDsB,eAAjD,GAAmEpB,iBAAnE;IACAK,IAAI,CAACa,UAAL,CAAgBC,gBAAhB,CAAiCrB,cAAjC,EAAiDuB,iBAAjD,GAAqE,QAArE;EACD,CARH;;EAUAC,aAAA,CAAGC,aAAH,CAAiB9B,OAAO,CAAC+B,QAAzB,EAAmC/B,OAAO,CAACgC,SAAR,EAAnC;AACD;;AAED,MAAMxB,YAAY,GAAIyB,KAAD,IAAmB;EACtC,IAAI,CAACA,KAAK,CAACC,KAAN,CAAY,OAAZ,CAAL,EAA2B;IACzB,OAAQ,IAAGD,KAAM,GAAjB;EACD;;EACD,OAAOA,KAAP;AACD,CALD"}