{"version":3,"sources":["ScrollPager.tsx"],"names":["React","StyleSheet","Keyboard","InteractionManager","Animated","event","divide","onChange","cond","eq","round","call","Value","ScrollPager","Component","x","props","navigationState","index","layout","width","y","createRef","key","wasTouched","keyboardDismissMode","onIndexChange","routes","findIndex","route","scrollTo","dismiss","animated","scrollViewRef","current","scrollView","getNode","type","listener","enterListeners","push","indexOf","splice","nativeEvent","contentOffset","position","layoutWidthNode","componentDidMount","componentDidUpdate","prevProps","offset","length","setValue","componentWillUnmount","interactionHandle","clearInteractionHandle","render","children","onSwipeStart","onSwipeEnd","overscroll","handleSwipeStart","createInteractionHandle","handleSwipeEnd","relativePosition","addListener","removeListener","jumpTo","swipeEnabled","onScroll","initialOffset","styles","container","flexDirection","flex","bounces","create"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { StyleSheet, Keyboard, InteractionManager } from 'react-native';\nimport Animated from 'react-native-reanimated';\nimport { Props } from './Pager';\nimport { Route, Listener } from './types';\n\nconst { event, divide, onChange, cond, eq, round, call, Value } = Animated;\n\ntype State = {\n  initialOffset: { x: number; y: number };\n};\n\nexport default class ScrollPager<T extends Route> extends React.Component<\n  Props<T> & { overscroll?: boolean },\n  State\n> {\n  static defaultProps = {\n    bounces: true,\n  };\n\n  componentDidMount() {\n    if (this.props.layout.width) {\n      this.scrollTo(\n        this.props.navigationState.index * this.props.layout.width,\n        false\n      );\n    }\n  }\n\n  componentDidUpdate(prevProps: Props<T>) {\n    const offset = this.props.navigationState.index * this.props.layout.width;\n\n    if (\n      prevProps.navigationState.routes.length !==\n        this.props.navigationState.routes.length ||\n      prevProps.layout.width !== this.props.layout.width\n    ) {\n      this.scrollTo(offset, false);\n    } else if (\n      prevProps.navigationState.index !== this.props.navigationState.index\n    ) {\n      this.scrollTo(offset);\n    }\n\n    if (prevProps.layout.width !== this.props.layout.width) {\n      this.layoutWidthNode.setValue(this.props.layout.width);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.interactionHandle !== null) {\n      InteractionManager.clearInteractionHandle(this.interactionHandle);\n    }\n  }\n\n  private initialOffset = {\n    x: this.props.navigationState.index * this.props.layout.width,\n    y: 0,\n  };\n\n  private wasTouched: boolean = false;\n\n  // InteractionHandle to handle tasks around animations\n  private interactionHandle: number | null = null;\n\n  private scrollViewRef = React.createRef<Animated.ScrollView>();\n\n  private jumpTo = (key: string) => {\n    this.wasTouched = false;\n    const { navigationState, keyboardDismissMode, onIndexChange } = this.props;\n\n    const index = navigationState.routes.findIndex(\n      (route) => route.key === key\n    );\n\n    if (navigationState.index === index) {\n      this.scrollTo(index * this.props.layout.width);\n    } else {\n      onIndexChange(index);\n      if (keyboardDismissMode === 'auto') {\n        Keyboard.dismiss();\n      }\n    }\n  };\n\n  private scrollTo = (x: number, animated = true) => {\n    if (this.scrollViewRef.current) {\n      // getNode() is not necessary in newer versions of React Native\n      const scrollView =\n        // @ts-ignore\n        typeof this.scrollViewRef.current?.scrollTo === 'function'\n          ? this.scrollViewRef.current\n          : this.scrollViewRef.current?.getNode();\n\n      // @ts-ignore\n      scrollView?.scrollTo({\n        x,\n        animated: animated,\n      });\n    }\n  };\n\n  private enterListeners: Listener[] = [];\n\n  private addListener = (type: 'enter', listener: Listener) => {\n    switch (type) {\n      case 'enter':\n        this.enterListeners.push(listener);\n        break;\n    }\n  };\n\n  private removeListener = (type: 'enter', listener: Listener) => {\n    switch (type) {\n      case 'enter': {\n        const index = this.enterListeners.indexOf(listener);\n\n        if (index > -1) {\n          this.enterListeners.splice(index, 1);\n        }\n\n        break;\n      }\n    }\n  };\n\n  private position = new Animated.Value(\n    this.props.navigationState.index * this.props.layout.width\n  );\n\n  private onScroll = event([\n    {\n      nativeEvent: {\n        contentOffset: {\n          x: this.position,\n        },\n      },\n    },\n  ]);\n\n  private layoutWidthNode = new Value(this.props.layout.width);\n\n  private relativePosition = divide(this.position, this.layoutWidthNode);\n\n  render() {\n    const {\n      children,\n      layout,\n      onSwipeStart,\n      onSwipeEnd,\n      overscroll,\n      onIndexChange,\n      navigationState,\n    } = this.props;\n\n    const handleSwipeStart = () => {\n      this.wasTouched = false;\n      onSwipeStart?.();\n      this.interactionHandle = InteractionManager.createInteractionHandle();\n    };\n\n    const handleSwipeEnd = () => {\n      this.wasTouched = true;\n      onSwipeEnd?.();\n      if (this.interactionHandle !== null) {\n        InteractionManager.clearInteractionHandle(this.interactionHandle);\n      }\n    };\n\n    return children({\n      position: this.relativePosition,\n      addListener: this.addListener,\n      removeListener: this.removeListener,\n      jumpTo: this.jumpTo,\n      render: (children) => (\n        <Animated.ScrollView\n          pagingEnabled\n          directionalLockEnabled\n          keyboardDismissMode=\"on-drag\"\n          keyboardShouldPersistTaps=\"always\"\n          overScrollMode=\"never\"\n          scrollToOverflowEnabled\n          scrollEnabled={this.props.swipeEnabled}\n          automaticallyAdjustContentInsets={false}\n          bounces={overscroll}\n          scrollsToTop={false}\n          showsHorizontalScrollIndicator={false}\n          scrollEventThrottle={1}\n          onScroll={this.onScroll}\n          onScrollBeginDrag={handleSwipeStart}\n          onScrollEndDrag={handleSwipeEnd}\n          onMomentumScrollEnd={this.onScroll}\n          contentOffset={this.initialOffset}\n          style={styles.container}\n          contentContainerStyle={\n            layout.width\n              ? {\n                  flexDirection: 'row',\n                  width: layout.width * navigationState.routes.length,\n                  flex: 1,\n                }\n              : null\n          }\n          ref={this.scrollViewRef}\n        >\n          {children}\n          <Animated.Code\n            exec={onChange(\n              this.relativePosition,\n              cond(eq(round(this.relativePosition), this.relativePosition), [\n                call([this.relativePosition], ([relativePosition]) => {\n                  if (this.wasTouched) {\n                    onIndexChange(relativePosition);\n                    this.wasTouched = false;\n                  }\n                }),\n              ])\n            )}\n          />\n        </Animated.ScrollView>\n      ),\n    });\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n});\n"]}